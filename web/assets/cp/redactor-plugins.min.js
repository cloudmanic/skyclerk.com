Redactor.add("plugin","counter",{translations:{en:{words:"words",chars:"chars"}},init:function(t){this.app=t,this.lang=t.lang,this.utils=t.utils,this.editor=t.editor,this.statusbar=t.statusbar},start:function(){this.editor.getElement().on("keyup.redactor-plugin-counter",this.count.bind(this)),this.count()},stop:function(){this.editor.getElement().off(".redactor-plugin-counter"),this.statusbar.remove("words"),this.statusbar.remove("chars")},count:function(){var t=0,s=0,r=0,e=this.editor.getElement().html();if(""!==(e=this._clean(e))){var a=e.split(/\s+/),i=e.match(/\s/g);t=a?a.length:0,r=i?i.length:0,s=e.length}var n={words:t,characters:s,spaces:r};this.app.broadcast("counter",n),this.statusbar.add("words",this.lang.get("words")+": "+n.words),this.statusbar.add("chars",this.lang.get("chars")+": "+n.characters)},_clean:function(t){return t=(t=(t=(t=(t=(t=(t=t.replace(/<\/(.*?)>/gi," ")).replace(/<(.*?)>/gi,"")).replace(/\t/gi,"")).replace(/\n/gi," ")).replace(/\r/gi," ")).replace(/&nbsp;/g,"1")).trim(),t=this.utils.removeInvisibleChars(t)}});

Redactor.add("plugin","limiter",{init:function(t){this.app=t,this.utils=t.utils,this.opts=t.opts,this.editor=t.editor,this.keycodes=t.keycodes},onpasting:function(t){if(this.opts.limiter){t=this.utils.removeInvisibleChars(t);var i=this._getText(),e=t.length+i.length;this.opts.input=!(e>=this.opts.limiter)}},start:function(){this.opts.limiter&&(this._count(),this.editor.getElement().on("keydown.redactor-plugin-limiter",this._limit.bind(this)))},stop:function(){this.editor.getElement().off(".redactor-plugin-limiter"),this.opts.input=!0},_limit:function(t){var i=t.which,e=t.ctrlKey||t.metaKey;i===this.keycodes.BACKSPACE||i===this.keycodes.DELETE||i===this.keycodes.ESC||i===this.keycodes.SHIFT||e&&65===i||e&&88===i||e&&82===i||e&&116===i||-1!==[37,38,39,40].indexOf(i)||this._count(t)},_count:function(t){if(this._getText().length>=this.opts.limiter)return t&&t.preventDefault(),this.opts.input=!1,!1;this.opts.input=!0},_getText:function(){var t=this.editor.getElement().text();return this.utils.removeInvisibleChars(t)}});
